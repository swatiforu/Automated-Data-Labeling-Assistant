{% extends "base.html" %}

{% block title %}Label Text - Data Labeling Assistant{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">
        <i class="fas fa-plus-circle me-2"></i>
        Label Text
    </h1>
</div>

<!-- Single Text Labeling -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-file-text me-2"></i>
                    Label Single Text
                </h5>
            </div>
            <div class="card-body">
                <form id="singleLabelForm">
                    <div class="mb-3">
                        <label for="textContent" class="form-label">Text to Label</label>
                        <textarea class="form-control" id="textContent" name="textContent" rows="4" 
                                  placeholder="Enter the text you want to label..." required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="source" class="form-label">Source (Optional)</label>
                        <input type="text" class="form-control" id="source" name="source" 
                               placeholder="e.g., customer feedback, social media, etc.">
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-magic me-2"></i>
                        Label with AI
                    </button>
                </form>
                
                <div id="singleLabelResult" class="mt-3" style="display: none;">
                    <div class="alert alert-success">
                        <h6><i class="fas fa-check-circle me-2"></i>Labeling Complete!</h6>
                        <div id="singleLabelDetails"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Batch Text Labeling -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-layer-group me-2"></i>
                    Batch Text Labeling
                </h5>
            </div>
            <div class="card-body">
                <form id="batchLabelForm">
                    <div class="mb-3">
                        <label for="batchTexts" class="form-label">Texts to Label (One per line)</label>
                        <textarea class="form-control" id="batchTexts" name="batchTexts" rows="8" 
                                  placeholder="Enter multiple texts, one per line...&#10;&#10;Example:&#10;This product is amazing!&#10;I'm not satisfied with the service&#10;How do I return this item?" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="batchSource" class="form-label">Source (Optional)</label>
                        <input type="text" class="form-control" id="batchSource" name="batchSource" 
                               placeholder="e.g., customer feedback, social media, etc.">
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-magic me-2"></i>
                        Label Batch with AI
                    </button>
                </form>
                
                <div id="batchLabelResult" class="mt-3" style="display: none;">
                    <div class="alert alert-success">
                        <h6><i class="fas fa-check-circle me-2"></i>Batch Labeling Complete!</h6>
                        <div id="batchLabelDetails"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Sample Texts -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-lightbulb me-2"></i>
                    Sample Texts for Testing
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Customer Feedback</h6>
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <button class="btn btn-sm btn-outline-secondary sample-text" 
                                        data-text="This product exceeded my expectations! The quality is outstanding and delivery was fast.">
                                    <i class="fas fa-copy me-1"></i>
                                    Copy
                                </button>
                            </li>
                            <li class="mb-2">
                                <button class="btn btn-sm btn-outline-secondary sample-text" 
                                        data-text="I'm disappointed with the customer service. The representative was rude and unhelpful.">
                                    <i class="fas fa-copy me-1"></i>
                                    Copy
                                </button>
                            </li>
                            <li class="mb-2">
                                <button class="btn btn-sm btn-outline-secondary sample-text" 
                                        data-text="How do I track my order? I haven't received any updates.">
                                    <i class="fas fa-copy me-1"></i>
                                    Copy
                                </button>
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>Social Media Posts</h6>
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <button class="btn btn-sm btn-outline-secondary sample-text" 
                                        data-text="Just tried the new restaurant downtown. The food was amazing and the atmosphere was perfect!">
                                    <i class="fas fa-copy me-1"></i>
                                    Copy
                                </button>
                            </li>
                            <li class="mb-2">
                                <button class="btn btn-sm btn-outline-secondary sample-text" 
                                        data-text="Traffic is terrible today. Wish I had taken the train instead of driving.">
                                    <i class="fas fa-copy me-1"></i>
                                    Copy
                                </button>
                            </li>
                            <li class="mb-2">
                                <button class="btn btn-sm btn-outline-secondary sample-text" 
                                        data-text="Can anyone recommend a good plumber in the area? Need one urgently.">
                                    <i class="fas fa-copy me-1"></i>
                                    Copy
                                </button>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    // Sample text copy functionality
    $('.sample-text').click(function() {
        const text = $(this).data('text');
        $('#textContent').val(text);
        $('#textContent').focus();
    });
    
    // Single text labeling
    $('#singleLabelForm').submit(function(e) {
        e.preventDefault();
        
        const formData = new FormData();
        formData.append('text', $('#textContent').val());
        formData.append('source', $('#source').val());
        
        $.ajax({
            url: '/api/label',
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function(response) {
                if (response.success) {
                    $('#singleLabelDetails').html(`
                        <strong>Category:</strong> <span class="badge bg-primary">${response.category}</span><br>
                        <strong>Confidence:</strong> <span class="text-success">${(response.confidence * 100).toFixed(1)}%</span><br>
                        <strong>Explanation:</strong> ${response.explanation || 'No explanation provided'}
                    `);
                    $('#singleLabelResult').show();
                    $('#singleLabelForm')[0].reset();
                }
            },
            error: function(xhr) {
                alert('Error: ' + xhr.responseText);
            }
        });
    });
    
    // Batch text labeling
    $('#batchLabelForm').submit(function(e) {
        e.preventDefault();
        
        const texts = $('#batchTexts').val().split('\n').filter(text => text.trim() !== '');
        if (texts.length === 0) {
            alert('Please enter at least one text to label.');
            return;
        }
        
        const formData = new FormData();
        texts.forEach(text => {
            formData.append('texts', text.trim());
        });
        formData.append('sources', $('#batchSource').val());
        
        $.ajax({
            url: '/api/label/batch',
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function(response) {
                if (response.success) {
                    let detailsHtml = '<div class="table-responsive"><table class="table table-sm">';
                    detailsHtml += '<thead><tr><th>Text</th><th>Category</th><th>Confidence</th></tr></thead><tbody>';
                    
                    response.labels.forEach(label => {
                        detailsHtml += `<tr>
                            <td>${label.text_content || 'N/A'}</td>
                            <td><span class="badge bg-primary">${label.category}</span></td>
                            <td><span class="text-success">${(label.confidence * 100).toFixed(1)}%</span></td>
                        </tr>`;
                    });
                    
                    detailsHtml += '</tbody></table></div>';
                    $('#batchLabelDetails').html(detailsHtml);
                    $('#batchLabelResult').show();
                    $('#batchLabelForm')[0].reset();
                }
            },
            error: function(xhr) {
                alert('Error: ' + xhr.responseText);
            }
        });
    });
});
</script>
{% endblock %} 